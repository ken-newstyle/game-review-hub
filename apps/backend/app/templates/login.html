{% extends "base.html" %}
{% block title %}ログイン | Game Review Hub{% endblock %}
{% block content %}
  <section class="gw-card gw-p24 gw-grid">
    <h1 class="gw-title">ログイン</h1>
    <p class="gw-muted">メールとパスワードでログインするか、新規登録してください。</p>

    <form id="login-form" class="gw-grid gw-gap12 gw-mt16">
      <input class="gw-input" type="email" id="email" placeholder="メールアドレス" required />
      <input class="gw-input" type="password" id="password" placeholder="パスワード（8文字以上）" minlength="8" required />
      <div class="gw-flex gw-gap8">
        <button class="gw-btn gw-btn-primary" type="submit">ログイン</button>
        <button class="gw-btn" id="register" type="button">新規登録</button>
      </div>
      <div id="msg" class="gw-msg"></div>
    </form>
  </section>
{% endblock %}

{% block scripts %}
<script>
  const API = (window.API_BASE || '/api');
  const form = document.getElementById('login-form');
  const msg = document.getElementById('msg');
  const email = document.getElementById('email');
  const password = document.getElementById('password');
  document.getElementById('register').addEventListener('click', async () => {
    msg.textContent = '';
    try {
      const r = await fetch(`${API}/auth/register`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email: email.value, password: password.value }) });
      if (!r.ok) throw new Error('登録に失敗しました');
      msg.textContent = '登録しました。続けてログインします。';
    } catch(e){ msg.textContent = e.message || 'エラーが発生しました'; }
  });
  form.addEventListener('submit', async (e) => {
    e.preventDefault(); msg.textContent='';
    try {
      const r = await fetch(`${API}/auth/login`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email: email.value, password: password.value }) });
      if (!r.ok) throw new Error('ログインに失敗しました');
      const data = await r.json();
      localStorage.setItem('access_token', data.access_token);
      location.href = '/home';
    } catch(e){ msg.textContent = e.message || 'エラーが発生しました'; }
  });
</script>
{% endblock %}

